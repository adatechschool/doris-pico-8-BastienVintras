pico-8 cartridge // http://www.pico-8.com
version 38
__lua__



function _init()
p={
x=5,
y=5,
dx=0,
dy=0,
h=8,
w=8}
create_snow()
state=0

timer=0
blinking=true
init_msg()
end

function _draw()
	cls()
	if (state<=5) draw_game() 
	if (state>5) draw_gameover()
end


function  _update()

if (state<=5) update_game()
if (state>5) update_gameover()
end

function is_grounded()
bloc=mget(flr(p.x+4)/8,flr(p.y)/8+1)

return fget(bloc,0)

end



function draw_game()
cls()
draw_background()
map(0,0,0,0,127,64)
print(check_flag(2,p.x/8,p.y/8),0,0,1)
	if (is_grounded()) then
	p.y=flr(flr(p.y)/8)*8
	end
	spr(1,p.x,p.y)	
	for s in all(snow) do
	pset(s.x,s.y,s.col)
 end
 draw_msg()
end


function update_game()
update_camera()
p.dx=0
if not check_flag(2,(p.x+8)/8,p.y/8) then
		if (btn(0)) p.dx=-1
if not check_flag(2,(p.x+0)/8,p.y/8) then
  
  if (btn(1)) p.dx=1
  p.x+=p.dx
end
end
if check_flag(1,(p.x)/8,(p.y)/8) then
	state += 1
	end
	
	


if (is_grounded()) then
p.dy=0
if(btnp(2))p.dy=-5.5
else
p.dy+=0.3
if(p.dy>4)p.dy=4

end
p.y+=p.dy

update_snow()

update_msg()

end

function update_gameover()
timer+=1
if (btn(❎)) then _init()

end
end
-->8
--camera

function update_camera()
camx=mid(0,p.x-(7.5*8),127*8)
--camy=mid(0,p.y+7.5,16)
camera(camx)
end

--fond
function draw_background()
 rectfill(0,0,127*8,127*8,13)
 rectfill(0,95,127*8,127*8,7)
 end
-->8
--effets
function update_snow()
 for s in all(snow) do
	s.y+=s.speed
  if s.y>128 then
		s.y=0
		s.x=rnd(256)
  end
 end
end

function create_snow()
snow={}
for i=1,20 do
local new_snow={
x=rnd(128),
y=rnd(128),
col=6,
speed=2}
add(snow, new_snow)
 end
end

-->8
-- flag 
	
function check_flag(flag,x,y)
	local sprite=mget(x,y)
	return fget(sprite,flag)
end

-->8
-- ecran de gameover
function draw_gameover()
cls()
 rectfill(0,0,128,128,0)
 print('game over !!!',p.x-18,46,2)
 print('game over !!!',p.x-18,45,8)
	if timer%20 == 0 then 
	blinking = not blinking
	end
	if blinking then 
	print('appuyez sur x', p.x-20,71,1)
	print('pour ressayer !',p.x-23,81,1)
	print('appuyez sur x', p.x-20, 70,9)
	print('pour ressayer !',p.x-23, 80,9)
	end
end
-->8
--messages 

function init_msg()
message={}
create_msg("l'eveil d'amazonia","appuyez sur ❎ pour commencer")
end

function create_msg(name,...)

msg_title=name
messages={...}
end

function update_msg()
	if btnp(❎) then
	deli(messages,1)
end
end 

function draw_msg()
if messages[1] then
local y=15


 rectfill(7,y,7+#msg_title*4,y+20,2)
 print (msg_title,10,y+2,9)

 rectfill(3,y+8,124,y+24,4)
 rect(3,y+8,124,y+24,4)
 print(messages[1],6,y+11,15)
end
end
__gfx__
0000000000039a000000000000039a00000000006666666611111111609820d03333333366333334666333336666566677555577000000000000000000000000
000000000334446000039a000334443000011100666666661111111156666d5033333333d3944449563333336665dd6657686875000000000000000000000000
00700700334414660334443033414410011ccc106666666611111111000600003333b3b339433363534333336665556657666675000000000000000000000000
0007700033444406334144103344444011c0cc0066666666111111110550550033333b33343f363333343333665dddd655566555000000000000000000000000
00077000000b400633444440000b4b0011ccccc055555555111111116066d0d03333b33334336333333343336655555677111177000000000000000000000000
0070070000bb7446000b4b0000b7b7000006c60077777777111111119055502033333333343637733333377365dddddd77655677000000000000000000000000
000000000bbbb06600b7b7000b4bb4000067670066666666111111110060d00033b3333334633f7733333f776655555677677677000000000000000000000000
00000000000550600bb4bb4000000000066c6c0066666666111111110660dd00333333334933337f333333f36666666676677667000000000000000000000000
00000000000550007776777677767777776677777677777611111111111111441111111144111111111111116666666655555555000000000000000000000000
49444494055000007cc7ccc67ccccc767cc7cc777cccccc711111111111111441111111144111111111111116666666655555555000000000000000000000000
44000094565500006cccc7c77cc7ccc77cccc7c77cccc7c711111111111111441111111144111111111111116666116655555555000000000000000000000000
04900440566550006cccccc77ccc6cc67c7cccc677ccccc711111111111111441111111144111111111111116661551655555555000000000000000000000000
00444400566651006c7ccc7776ccccc77ccc6cc666ccccc7171ffff11111114411ffffff44111111111111116115551655555555000000000000000000000000
00094000552661107ccccc7777c7ccc77ccc6cc776ccccc6155555511111114411ffffff44111111111111116555555655555555000000000000000000000000
000440005652661177ccccc77cccc77767ccccc7777ccc7714111141111111445555555544111111111111116565655655555555000000000000000000000000
00044000566616617677777677767777767767777766677714111141111111445555555544111111111111116555555655555555000000000000000000000000
0aa00000c0c00c0c0000000000000000000000000000000000000000000000006666666666666666000000006565655600000000000000000000000000000000
aaaa00000c6706c00000000000000000000000000000000000000000000000006666666666666666000000006555555600000000000000000000000000000000
a9aaaaaac660066c0000000000000000000000000000000000000000000000006555566656655555000000006565655600000000000000000000000000000000
a0aaaaaa000c67700000000000000000000000000000000000000000000000006577756656656565000000006555555600000000000000000000000000000000
aaaa9a9a0006c7700000000000000000000000000000000000000000000000006777775656655555000000006565655600000000000000000000000000000000
9aa90909c660066c0000000000000000000000000000000000000000000000006777775656656565000000006555555600000000000000000000000000000000
099000090c6006c00000000000000000000000000000000000000000000000006777775656655555000000006555555600000000000000000000000000000000
00000000c0c00c0c0000000000000000000000000000000000000000000000006577755656656565000000006555555600000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000060ddd0d00000000000000000000000007777777700000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000568686500000000000000000000000007777677600000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000006660000000000000000000000000006676676600000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000055055000000000000000000000000006666666600000000000000000000000000000000
000000000000000000000000000000000000000000000000000000006066d0d00000000000000000000000006666666600000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000905550200000000000000000000000006666666600000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000060d0000000000000000000000000006666666600000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000660dd000000000000000000000000006666666600000000000000000000000000000000
__gff__
0000000000000002000000000000000000000505050500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
00000d000000000d00000000000d000000000000000000000000000d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000d000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000d0000000000000d00000000000d0000000000000d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000d0000000d000000000000000d000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000d000000000000000000000d000000000000000d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000d00000000000000000000000000000000000000000000000000000d00000000000000000700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0d0000000000000000000d000000000000001b12121212120000000000000000000000121212121200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000007000000000000000000002b1b1b00001b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000012131314121415000000002b2b2b00002b001b1b0007000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000001213151f121213000000002b2b2b00002b002b2b0012141415000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000121f1f061f1f14000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000012060606060613000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000120617181e1915000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1212121212121212121212121212121212151515151515151515151515151515151515151515151515151515151515151515151515151515151515151515151515151515151515151515151515151515151515151515151515151515151515151515151515151515151515151515151515151515151515151515151515151515
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000012000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
